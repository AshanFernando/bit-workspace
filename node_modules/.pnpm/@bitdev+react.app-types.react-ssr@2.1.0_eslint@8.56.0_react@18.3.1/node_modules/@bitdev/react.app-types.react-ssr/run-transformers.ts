import { WebpackConfigMutator } from '@teambit/webpack.modules.config-mutator';

export type WebpackConfigTransformContext = {
  /**
   * app name
   */
  appName: string;

  /**
   * is dev mode or not.
   */
  dev?: boolean;

  /**
   * is the webpack configuration is intended for server side rendering.
   */
  ssr?: boolean;
}

export type WebpackConfigTransformer = (
  config: WebpackConfigMutator,
  context: WebpackConfigTransformContext
) => WebpackConfigMutator;

export function runTransformersWithContext(
  config: WebpackConfigMutator,
  transformers: Array<WebpackConfigTransformer> = [],
  // context: WebpackConfigTransformContext | WebpackConfigDevServerTransformContext
  context: WebpackConfigTransformContext
): WebpackConfigMutator {
  if (!Array.isArray(transformers)) return config;
  const newConfig = transformers.reduce((acc, transformer) => {
    // @ts-ignore
    return transformer(acc, context);
  }, config);
  return newConfig;
}
